<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Entry</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        #anime-search-results {
            border: 1px solid #ccc;
            max-height: 200px;
            overflow-y: auto;
        }
        #anime-search-results div {
            padding: 10px;
            cursor: pointer;
        }
        #anime-search-results div:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">Add New Anime Entry</h1>
        <form class="form-container" action="/add" method="POST" id="addEntryForm">
            <label for="anime-search">Search Anime:</label>
            <input type="text" id="anime-search" name="anime-search" autocomplete="off">
            <div id="anime-search-results"></div>
            <input type="hidden" id="anime_name" name="name">
            <input type="hidden" id="image_url" name="image_url">

            <label for="progress">Progress:</label>
            <select id="progress" name="progress" required>
                <option value="Just Started">Just Started</option>
                <option value="In Progress">In Progress</option>
                <option value="Finished">Finished</option>
            </select><br>

            <label for="rating">Rating:</label>
            <input type="number" id="rating" name="rating" min="0" max="10" step="0.1" required><br>

            <label for="summary">Summary:</label>
            <textarea id="summary" name="summary" required></textarea><br>

            <label for="spoiler">Does it include spoilers?</label>
            <input type="checkbox" id="spoiler" name="spoiler"><br>

            <button type="submit">Add Entry</button>
        </form>
    </div>

    <script>
        document.getElementById('anime-search').addEventListener('input', async function () {
            const query = this.value;
            if (query.length >= 3) {
                const response = await fetch(`/search-anime?q=${query}`);
                const results = await response.json();
                const resultsContainer = document.getElementById('anime-search-results');
                resultsContainer.innerHTML = '';

                results.forEach(anime => {
                    const div = document.createElement('div');
                    div.textContent = anime.title.romaji;
                    div.setAttribute('data-title', anime.title.romaji);
                    div.setAttribute('data-image', anime.coverImage.large);
                    div.style.cursor = 'pointer';
                    div.addEventListener('click', () => {
                        document.getElementById('anime-search').value = anime.title.romaji;
                        document.getElementById('anime_name').value = anime.title.romaji; // Set the anime name
                        document.getElementById('image_url').value = anime.coverImage.large;
                        resultsContainer.innerHTML = '';
                    });
                    resultsContainer.appendChild(div);
                });
            } else {
                document.getElementById('anime-search-results').innerHTML = '';
            }
        });
    </script>
</body>
</html>
